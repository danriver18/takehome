<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Legacy Bridge</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 2rem; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #ddd; padding: 8px; }
      th { background: #f5f5f5; text-align: left; }
      select { margin-bottom: 1rem; }
    </style>
  </head>
  <body>
    <h1>Legacy Bridge Transactions</h1>
    <label>
      Filter by category:
      <select id="categoryFilter"></select>
    </label>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Merchant</th>
          <th>Description</th>
          <th>Amount</th>
          <th>Currency</th>
          <th>Date</th>
          <th>Category</th>
        </tr>
      </thead>
      <tbody id="txnTableBody"></tbody>
    </table>

    <script type="module">
      const categorySelect = document.getElementById("categoryFilter");
      const tbody = document.getElementById("txnTableBody");

      async function fetchCategories() {
        const res = await fetch("/api/categories");
        const { data } = await res.json();
        categorySelect.innerHTML = `<option value="All">All</option>` + data.map((c) => `<option>${c}</option>`).join("");
      }

      function formatAmount(amountCents) {
        return (amountCents / 100).toFixed(2);
      }

      async function fetchTransactions(category) {
        const url = category && category !== "All" ? `/api/transactions?category=${encodeURIComponent(category)}` : "/api/transactions";
        const res = await fetch(url);
        const { data } = await res.json();
        renderTable(data);
      }

      function renderTable(items) {
        tbody.innerHTML = items
          .map(
            (txn) => `
          <tr>
            <td>${txn.externalId}</td>
            <td>${txn.merchant}</td>
            <td>${txn.description}</td>
            <td>${formatAmount(txn.amountCents)}</td>
            <td>${txn.currency}</td>
            <td>${new Date(txn.transactedAt).toLocaleDateString()}</td>
            <td>${txn.category}</td>
          </tr>`
          )
          .join("");
      }

      categorySelect.addEventListener("change", (e) => fetchTransactions(e.target.value));

      (async function init() {
        await fetchCategories();
        await fetchTransactions();
      })();
    </script>
  </body>
</html>

